<p>I wanted a board that shows the state of all I/O pins on LEDs with all of these properties....</p><ul><li>Works for Digital Input, Output, and Input Pullup</li><li>Pushbutton to drive the pin high, very weak pulldown (much weaker than on-chip pullup)</li><li>Works for analog pins (thumbwheel pot), but also works when the same pin is used for digital</li><li>LED shows actual analog level - LED current should be linear to actual voltage</li><li>LED current does not interfere with analog voltage</li><li>LED does not interfere with weak signals, or input pullup or pulldown</li><li>Inexpensive - under $0.50 per pin - many parts are ok, as long as they're cheap!</li></ul><p><img alt="" src="http://www.dorkbotpdx.org/files/images/t3iotest1.jpg" style="width: 640px; height: 355px;"></p><p>"Read More" for the circuit details and photos.....</p><p><!--break--></p><p>Here is the circuit I ended up using.&nbsp; At first, this may seem expensive.&nbsp; However, $15 buys 100 LMV358 dual opamps at Digikey (or $10 buys 25 of them, but they're so useful that 75 more for $5 is a real bargain).&nbsp; The rest of the parts are cheap resistors, and course the LED, pushbutton and thumbwheel pot.</p><p><img alt="" src="http://www.dorkbotpdx.org/files/images/t3iotest4.png" style="width: 640px; height: 265px;"></p><p>The 2.2M and 100K resistors cause the pin to default to low.&nbsp; However, 2.3M is so weak that the chip's internal pullup resistor will easily pull the pin high.&nbsp; Of course, the thumbwheel pot also drives the pin for the ones with analog input ability.&nbsp; I used the same circuit for all pins, except leaving the pot off for the digital-only pins.&nbsp; For testing digital inputs, the pushbutton can bring the pin high, and the 330 ohm resistor is meant to protect the pin if it happens to be configured as an output when someone presses the button.</p><p>The opamp circuit is the interesting part.&nbsp; I'm sure many people reading this will feel an opamp is too extravigant or a "waste" for only driving a LED.&nbsp; However, these opamps are 200 (2 per chip) for only $15 at Digikey.&nbsp; The huge advantage is you can experiment with the pin without the LED loading.&nbsp; You can try connecting very weak signals, or I2C, or signals like the output of an IR receiver module with a pullup resistor, and the LED always works without the power to drive the LED loading &amp; changing the signal.</p><p>The circuit works by measuring the LED current with a 47 ohm resistor.&nbsp; The opamp's feedback loop causes the voltage on the 47 ohm resistor to match the voltage beween the 2.2M and 100K resistor, so the LED always has a current that is linear with the actual voltage on the pin.&nbsp; Even for the non-analog pins, that's very useful while experimenting.&nbsp; Sometimes the LED will be dim indicating things aren't quite as expected, even though everything seems to work from the software side.</p><p>EDIT: I made a mod to this circuit after this photo and blog.&nbsp; I added a 470pF capacitor in parallel to the 100K resistor. For extremely fast PWM, that low-pass filters the input to within the bandwidth of the opamp, so you still get a perfectly corresponding analog current in the LED.</p><p>When I first built this, I neglected the 150K feedback resistors.&nbsp; You can see here when I added them in:</p><p><img alt="" src="http://www.dorkbotpdx.org/files/images/t3iotest3.jpg" style="width: 640px; height: 336px;"></p><p>The opamp has PNP transistors on it's input, so a tiny current is sourced from the input pins.&nbsp; That tiny current, flowing through 100K creates a few millivolts, which is enough to put a bit of current through the LED.&nbsp; I used low current LEDs (HLMP-D150A), where that tiny current causes it to light up just a bit.&nbsp; Of course, that's no good, because you want "very dim but not completely off" to indicate something is wrong.&nbsp; The 150K resistor adds slightly more than 100K impedance on the other input, so the opamp sees just a slight negative voltage between its inputs when the pin is at zero volts (or just a few millivolts).&nbsp; At even with only 25 mV (something driving the pin low, but not all the way to ground) the LED starts lighting up properly.</p><p>The end result is a "breakout board" that lets me easily test every pin in every possible mode, with LEDs showing a true indication of every actual analog voltage!</p><p><img alt="" src="http://www.dorkbotpdx.org/files/images/t3iotest2.jpg" style="width: 640px; height: 414px;"></p><p>I realize this is probably excessive design for most people, but when you're making a development board and testing nearly every major Arduino library, it's amazing how handy tools like this can be.&nbsp; So I thought I'd document this little circuit, and especially the 150K feedback resistor trick that makes it work so well with these higher impedances and the chip LMV358 opamp.</p>
