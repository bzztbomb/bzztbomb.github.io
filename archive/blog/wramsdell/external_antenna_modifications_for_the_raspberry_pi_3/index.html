<head>
  <title>External antenna modifications for the Raspberry Pi 3</title>
  <link rel="stylesheet" href="/css/archive.css">
</head>

<body>
  <div id="db-header"></div>
  <h1 class="db-page-header">External antenna modifications for the Raspberry Pi 3</h1>
  <h2 class="db-page-header">By: wardr</h2>
  <h3 class="db-page-header">2016-03-10 00:06:45</h3>

  <div id="db-content">
    <h2><strong>Preface:</strong></h2><p>This post will detail a couple of different ways that an external antenna can be added to the Raspberry Pi 3.</p><p>DO NOT TRY THIS AT HOME. &nbsp;ALL OF THE FOLLOWING WILL HAPPEN:<br>1) YOU WILL VOID YOUR WARRANTY<br>2) YOU WILL VIOLATE FCC REGULATIONS<br>3) THE PI'S WI-FI CERTIFICATION WILL BE VOID<br>IN ADDITION, YOU COULD EASILY DAMAGE YOUR PI</p><p>Please view this as a purely experimental exercise and proceed at your own risk.</p><p>It's not clear why an external antenna is not an option for the Pi 3, there are a number of possible reasons and I don't presume to know the Raspberry Pi Foundation's exact rationale. &nbsp;It could be to improve the out-of-box experience, an integrated antenna "just works" and there's no potential for the antenna connector to be broken plugging in an antenna. &nbsp;It could be to reduce complexity, the unit with an integrated antenna is compact and self-contained. &nbsp;It could be for regulatory reasons: in order to sell the device for use with a user-supplied antenna, the performance characteristics of that antenna need to be specified as part of the user instructions, and those characteristics must be adhered to in order to maintain compliance. &nbsp;Good luck with that.</p><h2><strong>Overview:</strong></h2><p>There are two basic approaches to adding a connector for an external antenna: remove the onboard antenna on the top side of the board and solder a coaxial pigtail in its place, or use the supplied pads on the bottom side and mount a U.FL connector. &nbsp;The first approach is much easier and can likely be accomplished with few special tools aside from a good soldering iron; however it results in compromised performance. &nbsp;The second approach involves precision soldering and is best attempted with strong magnification and a very fine soldering iron tip. &nbsp;Do not attempt it unless you're comfortable working with 0201 components (0.020" by 0.010", about the width of two and a half human hairs). &nbsp;It does result in substantially improved performance as compared to the top mount approach.</p><h2><strong>Top mount:</strong></h2><p>Start by removing the onboard antenna. &nbsp;Soldering tweezers or a heat gun can be used, or a well-tinned soldering iron with a sufficiently large tip. &nbsp;After removal, the board will look like this:</p><p><img alt="Raspberry Pi 3 top view #1, showing coaxial attachment point" src="/files/images/Top_1.preview.jpg" style="width: 464px; height: 640px;"></p><p>Note that some soldermask will need to be cleared away to attach the coax's shield, as seen to the left in the image. &nbsp;Next, prepare the coax tail. &nbsp;Strip the outer insulation back ~0.150" (3.75mm), tin the shield, then trim the shield back about 0.100" (2.5mm), finally, strip the center conductor about 0.050" (1.25mm) from the end. &nbsp;Solder the shield to the groundplane, and the center conductor to the antenna feed pad. &nbsp;The finished result will look like this:</p><p><img alt="Top view #2, showing the coax attached" src="/files/images/Top_2.preview.jpg" style="width: 473px; height: 640px;"></p><p>The finished product, with coaxial "tail" attached will look like ths:</p><p><img alt="Finished top view" src="/files/images/Top_3.preview.jpg" style="width: 638px; height: 640px;"></p><h2><strong>U.FL Connector:</strong></h2><p>Mounting a U.FL connector to the board is straightforward for those with experience working with miniscule surface mount devices. &nbsp;It involves clearing some soldermask and rotating one zero-ohm resistor.</p><p>Here is a U.FL connector overlaid on the provided pads:</p><p><img alt="Raspberry Pi bottom view, showing U.FL connector overlaid on the provided mounting pads" src="/files/images/Bottom_2.preview.jpg" style="width: 640px; height: 480px;"></p><p>Note that while the U.FL connector fits very well on the two exposed pads, there's soldermask covering the area where one of the leads falls. &nbsp;While you could just solder the two exposed pins, for mechanical robustness and optimal RF performance it's best to clear out that solder mask and solder the lead. &nbsp;After mounting the U.FL, rotate the resistor nearest the output filter, the large white device in the bottom of the image, 45 degrees to the left. &nbsp;The result will look like this:</p><p><img alt="Raspberry Pi 3 bottom view #3: U.FL connector mounted" src="/files/images/Bottom_3.preview.jpg" style="width: 551px; height: 640px;"></p><p>Be careful not to short ground to the header pin just above the connector.</p><p>Another approach would be to cut the output trace leading to the antenna and add a solder blob to bridge the output trace to the trace leading to the U.FL connector. &nbsp;I haven't tried this, but I don't see any reason it wouldn't work, though likely with some adverse impact on the RF performance.</p><h2><strong>Performance:</strong></h2><p>I configured my Raspberry Pi 3 as an access point following the excellent instructions here:<br><a href="https://learn.adafruit.com/downloads/pdf/setting-up-a-raspberry-pi-as-a-wifi-access-point.pdf">https://learn.adafruit.com/downloads/pdf/setting-up-a-raspberry-pi-as-a-wifi-access-point.pdf</a></p><p>After completing the steps in that procedure and rebooting, I was able to connect to the Pi with my Android phone. &nbsp;Using a spectrum analyzer with an attached rubber duckie antenna, I was able to observe the AP beacon packets being transmitted. &nbsp;I captured the transmitted beacon spectrum at channels 1, 6, and 11 (2412, 2437, and 2462 MHz), then moved on to conducted measurements.</p><p>I observed the conducted output power of the Pi using a Tektronix MDO4000-series mixed-domain oscilloscope, using an RF power trigger on the beacon packets. &nbsp;Power measurements were calibrated to an HP 8481D power sensor. &nbsp;The observed RF output powers are shown below:<br><style type="text/css">.tg  {border-collapse:collapse;border-spacing:0;}.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}.tg .tg-yw4l{vertical-align:top}</style></p><table class="tg"><tbody><tr><th class="tg-yw4l">Channel</th><th class="tg-yw4l">Frequency</th><th class="tg-yw4l">Coaxial tail output power</th><th class="tg-yw4l">U.FL output power</th></tr><tr><td class="tg-yw4l">1</td><td class="tg-yw4l">2412 MHz</td><td class="tg-yw4l">14.13 dBm</td><td class="tg-yw4l">15.98 dBm</td></tr><tr><td class="tg-yw4l">6</td><td class="tg-yw4l">2437 MHz</td><td class="tg-yw4l">13.67 dBm</td><td class="tg-yw4l">16.15 dBm</td></tr><tr><td class="tg-yw4l">11</td><td class="tg-yw4l">2462 MHz</td><td class="tg-yw4l">13.47 dBm</td><td class="tg-yw4l">16.39 dBm</td></tr></tbody></table><p>The U.FL numbers are consistently 2-3 dBm higher, almost a doubling in conducted power at the high end of the band. &nbsp;This is due to the massive impedance discontinuities presented by the antenna feed trace and the exposed center conductor of the coaxial cable. &nbsp;While it's likely possible to recoup some of that with RF tuning using the series and shunt placements in the RF path, at that point it makes more sense to go to the U.FL connector approach. &nbsp;A comparison of the output spectra is shown below, with no compensation applied (hence the radiated power is much lower than the conducted powers). &nbsp;All graphs use a resolution bandwidth of 10 kHz.</p><p><img alt="Output power comparison" src="/files/images/Pout.preview.png" style="width: 640px; height: 465px;"></p><p>A normalized graph showing the relative spectral regrowth is below.</p><p><img alt="Spectral regrowth of the three approaches" src="/files/images/Regrowth.preview.png" style="width: 640px; height: 464px;"></p><p>This graph is useful for comparing the in-band noise performance of the various approaches. &nbsp;The onboard antenna fares the worst close-in to the carrier, likely due to either fundamental mismatch or poor harmonic termination impacting power amplifier linearity. &nbsp;Further out the spectra become more comparable. &nbsp;The violating spikes are transient in nature, not part of the modulated waveform. &nbsp;Also, the resolution bandwidth used here is incorrect, it should be 100 kHz for 802.11 spectral mask measurement.</p><h2><strong>Future Work:</strong></h2><p>No attempt has been made to characterize out-of-band performance, or performance with any particular make or model of external antenna. &nbsp;A more comprehensive review of spurious and harmonic emissions is advised. &nbsp;Also, while it's likely that the U.FL and coaxial cable approaches lead to satisfactory WLAN performance, further analysis of adjacent channel power and error vector magnitude would be wise.</p>
  </div>

  <div id="db-back-to-index">
    <a href="/archive/index.html">Back to archive index</a>
  </div>
</body>
