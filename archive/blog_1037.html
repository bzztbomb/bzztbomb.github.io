Ideal diode circuit fixing
2013-07-16 01:01:53
RussellSenior

<p>At the bi-weekly meeting tonight, as promised, I brought my non-working circuit, and as promised, Paul helped me get it working.&nbsp; It is a circuit that allows current to flow through a p-channel mosfet (<a href="http://www.fairchildsemi.com/ds/FQ/FQP47P06.pdf">http://www.fairchildsemi.com/ds/FQ/FQP47P06.pdf</a>) from a power supply to a 12V sealed lead-acid battery and a load (which draws about 120 mA, normally), but that prevents current from flowing from the battery back into the power supply.&nbsp; The idea is to use an op-amp to compare the voltages upstream and downstream of the mosfet.&nbsp; If the upstream has a higher voltage, then current is flowing in the favored direction.&nbsp; If the upstream is lower than the downstream voltage, then current is flowing in the wrong direction and I want to turn the mosfet off.&nbsp; The mosfet has a very small resistance, about 20 milliohms.&nbsp; Paul supplied a better op-amp (LMC6482 CMOS dual rail-to-rail op-amp) than I'd been using (a generic LM741).</p><p><br><img alt="ideal diode circuit diagram" src="http://www.aracnet.com/~seniorr/ideal-diode.png" style="width: 542px; height: 342px;"></p><p>I had been having trouble getting the transistor to turn off.&nbsp; The thing that I *think* fixed it was the introduction of voltage dividers to move the op-amp inputs away from the op-amp power supply rail voltages.&nbsp; This I accomplished by using 2 10k trimmer pots, adjusted so they were as close to the same relative resistance as possible.&nbsp; The wiper contact provides ~50% of the input voltage to the op-amp inputs.&nbsp; The adjustment of the potentiometers is crucial to having the op-amp turn off the mosfet when the current begins to reverse.&nbsp; Although they are not fine-tuned, they were close enough to observe the mosfet turn on and off.</p><p>Thanks also to Scott Dixon who provided a DVM to measure the power supply current.&nbsp; When the mosfet turns off, the current it was measuring should go to zero, which it did.&nbsp; Paul also suggested adding a 100 Ohm resister between the op-amp output and the transistor gate.&nbsp; I added a 10k resistor between the gate and ground (not shown above), just to make sure the gate was discharging when the op-amp went low.</p><p>As proof, attached are a couple photos I took of the rig.&nbsp; Thanks to all that helped out!</p>